{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Code Entity Schema",
  "definitions": {
    "EntityType": {
      "type": "string",
      "enum": [
        "function", "async_function", "method", "class", "interface",
        "variable", "constant", "module", "file", "package",
        "import", "decorator", "annotation"
      ]
    },
    "RelationshipType": {
      "type": "string",
      "enum": [
        "calls", "imports", "inherits", "implements", "uses",
        "contains", "overrides", "decorates", "returns",
        "parameter", "depends_on", "similar_to"
      ]
    },
    "Language": {
      "type": "string",
      "enum": [
        "python", "javascript", "typescript", "jsx", "tsx",
        "java", "cpp", "c", "go", "rust", "unknown"
      ]
    },
    "Location": {
      "type": "object",
      "required": ["file_path", "start_line", "end_line"],
      "properties": {
        "file_path": {"type": "string"},
        "start_line": {"type": "integer", "minimum": 1},
        "end_line": {"type": "integer", "minimum": 1},
        "start_column": {"type": "integer", "minimum": 0},
        "end_column": {"type": "integer", "minimum": 0}
      }
    },
    "Entity": {
      "type": "object",
      "required": ["id", "type", "name", "language", "location"],
      "properties": {
        "id": {"type": "string"},
        "type": {"$ref": "#/definitions/EntityType"},
        "name": {"type": "string"},
        "qualified_name": {"type": "string"},
        "language": {"$ref": "#/definitions/Language"},
        "location": {"$ref": "#/definitions/Location"},
        "signature": {"type": "string"},
        "raw_code": {"type": "string"},
        "hash": {"type": "string"},
        "dependencies": {
          "type": "array",
          "items": {"type": "string"}
        },
        "tags": {
          "type": "array",
          "items": {"type": "string"}
        },
        "embedding": {
          "type": "array",
          "items": {"type": "number"}
        },
        "created_at": {"type": "string", "format": "date-time"},
        "updated_at": {"type": "string", "format": "date-time"}
      }
    },
    "Relationship": {
      "type": "object",
      "required": ["id", "from_entity_id", "to_entity_id", "relationship_type"],
      "properties": {
        "id": {"type": "string"},
        "from_entity_id": {"type": "string"},
        "to_entity_id": {"type": "string"},
        "relationship_type": {"$ref": "#/definitions/RelationshipType"},
        "weight": {"type": "number", "minimum": 0},
        "confidence": {"type": "number", "minimum": 0, "maximum": 1},
        "source": {"type": "string"},
        "created_at": {"type": "string", "format": "date-time"}
      }
    }
  }
}

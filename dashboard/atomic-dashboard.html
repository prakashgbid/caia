<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAIA Atomic-Level Master Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .grid-auto-fit {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: transform 0.3s;
        }
        .metric-card:hover { transform: translateY(-4px); }
    </style>
</head>
<body class="bg-gray-900 text-gray-100" x-data="dashboard()">
    <!-- Header with Live Status -->
    <header class="bg-gray-800 shadow-2xl border-b border-gray-700">
        <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent">
                        <i class="fas fa-atom"></i> CAIA Atomic Master Dashboard
                    </h1>
                    <span class="px-3 py-1 bg-green-500 text-xs rounded-full flex items-center">
                        <span class="pulse-dot w-2 h-2 bg-white rounded-full mr-2"></span>
                        LIVE
                    </span>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="refreshAll()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg flex items-center">
                        <i class="fas fa-sync-alt mr-2" :class="{'animate-spin': refreshing}"></i>
                        Refresh All
                    </button>
                    <span class="text-sm text-gray-400">Last Update: <span x-text="lastUpdate"></span></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard Grid -->
    <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Top Metrics Row -->
        <div class="grid-auto-fit mb-6">
            <template x-for="metric in topMetrics" :key="metric.name">
                <div class="metric-card text-white rounded-xl p-6 shadow-xl">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm opacity-80" x-text="metric.label"></p>
                            <p class="text-3xl font-bold mt-2" x-text="metric.value"></p>
                            <p class="text-xs mt-2 opacity-70" x-text="metric.detail"></p>
                        </div>
                        <i :class="metric.icon" class="text-3xl opacity-50"></i>
                    </div>
                </div>
            </template>
        </div>

        <!-- Tabbed Interface -->
        <div class="bg-gray-800 rounded-xl shadow-2xl">
            <div class="border-b border-gray-700 overflow-x-auto scrollbar-thin">
                <nav class="flex space-x-1 p-2">
                    <template x-for="tab in tabs" :key="tab.id">
                        <button
                            @click="activeTab = tab.id"
                            :class="{'bg-blue-600': activeTab === tab.id, 'bg-gray-700 hover:bg-gray-600': activeTab !== tab.id}"
                            class="px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors">
                            <i :class="tab.icon" class="mr-2"></i>
                            <span x-text="tab.name"></span>
                            <span x-show="tab.count" class="ml-2 px-2 py-0.5 bg-gray-900 rounded-full text-xs" x-text="tab.count"></span>
                        </button>
                    </template>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="p-6">
                <!-- System Overview Tab -->
                <div x-show="activeTab === 'overview'" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <template x-for="system in systems" :key="system.name">
                            <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                                <div class="flex justify-between items-center mb-3">
                                    <h3 class="font-semibold" x-text="system.name"></h3>
                                    <span :class="system.status === 'active' ? 'bg-green-500' : 'bg-red-500'"
                                          class="w-3 h-3 rounded-full"></span>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Port:</span>
                                        <span x-text="system.port || 'N/A'"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Type:</span>
                                        <span x-text="system.type"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Path:</span>
                                        <span class="text-xs truncate" :title="system.path" x-text="system.path"></span>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Projects & Packages Tab -->
                <div x-show="activeTab === 'projects'" class="space-y-4">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Projects Tree -->
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h3 class="font-semibold mb-4 text-lg">
                                <i class="fas fa-folder-tree mr-2"></i>Project Structure
                            </h3>
                            <div class="space-y-2 max-h-96 overflow-y-auto scrollbar-thin">
                                <template x-for="project in projectTree" :key="project.path">
                                    <div class="pl-2">
                                        <button @click="project.expanded = !project.expanded"
                                                class="flex items-center hover:text-blue-400 w-full text-left">
                                            <i class="fas mr-2" :class="project.expanded ? 'fa-folder-open' : 'fa-folder'"></i>
                                            <span x-text="project.name"></span>
                                            <span class="ml-auto text-xs text-gray-400" x-text="`(${project.items})`"></span>
                                        </button>
                                        <div x-show="project.expanded" class="pl-6 mt-2 space-y-1">
                                            <template x-for="item in project.children" :key="item.name">
                                                <div class="flex items-center text-sm text-gray-300">
                                                    <i :class="item.icon" class="mr-2 text-xs"></i>
                                                    <span x-text="item.name"></span>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Package Details -->
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h3 class="font-semibold mb-4 text-lg">
                                <i class="fas fa-box mr-2"></i>Package Analytics
                            </h3>
                            <canvas id="packageChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Agents Tab -->
                <div x-show="activeTab === 'agents'" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        <template x-for="agent in agents" :key="agent.name">
                            <div class="bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition-colors cursor-pointer">
                                <div class="flex items-center mb-2">
                                    <i :class="agent.icon" class="text-2xl mr-3 text-blue-400"></i>
                                    <h4 class="font-semibold" x-text="agent.name"></h4>
                                </div>
                                <p class="text-xs text-gray-400 mb-3" x-text="agent.description"></p>
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-400">Status:</span>
                                    <span :class="agent.active ? 'text-green-400' : 'text-gray-500'"
                                          x-text="agent.active ? 'Active' : 'Inactive'"></span>
                                </div>
                                <div class="flex justify-between text-xs mt-1">
                                    <span class="text-gray-400">Tools:</span>
                                    <span x-text="agent.tools.join(', ')"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- CC Configs Tab -->
                <div x-show="activeTab === 'configs'" class="space-y-4">
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-lg">
                            <i class="fas fa-cog mr-2"></i>Claude Code Configurations
                        </h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                            <template x-for="config in ccConfigs" :key="config.category">
                                <div class="bg-gray-800 rounded-lg p-4">
                                    <h4 class="font-semibold mb-3 text-blue-400" x-text="config.category"></h4>
                                    <div class="space-y-2">
                                        <template x-for="item in config.items" :key="item.name">
                                            <div class="flex justify-between text-sm">
                                                <span class="text-gray-400" x-text="item.name"></span>
                                                <span class="font-mono text-xs"
                                                      :class="item.enabled ? 'text-green-400' : 'text-red-400'"
                                                      x-text="item.value"></span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Rules & Hooks Tab -->
                <div x-show="activeTab === 'rules'" class="space-y-4">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h3 class="font-semibold mb-4 text-lg">
                                <i class="fas fa-gavel mr-2"></i>Enforcement Rules
                            </h3>
                            <div class="space-y-3">
                                <template x-for="rule in rules" :key="rule.name">
                                    <div class="bg-gray-800 rounded p-3">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium" x-text="rule.name"></span>
                                            <span :class="rule.enforced ? 'bg-green-500' : 'bg-yellow-500'"
                                                  class="px-2 py-1 text-xs rounded">
                                                <span x-text="rule.enforced ? 'ENFORCED' : 'WARNING'"></span>
                                            </span>
                                        </div>
                                        <p class="text-xs text-gray-400 mt-2" x-text="rule.description"></p>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <div class="bg-gray-700 rounded-lg p-4">
                            <h3 class="font-semibold mb-4 text-lg">
                                <i class="fas fa-plug mr-2"></i>Active Hooks
                            </h3>
                            <div class="space-y-2">
                                <template x-for="hook in hooks" :key="hook.name">
                                    <div class="flex items-center justify-between p-2 bg-gray-800 rounded">
                                        <div class="flex items-center">
                                            <span class="w-2 h-2 bg-green-400 rounded-full mr-3"></span>
                                            <span class="text-sm" x-text="hook.name"></span>
                                        </div>
                                        <span class="text-xs text-gray-400" x-text="hook.trigger"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- APIs Tab -->
                <div x-show="activeTab === 'apis'" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <template x-for="api in apis" :key="api.name">
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="flex justify-between items-center mb-3">
                                    <h4 class="font-semibold" x-text="api.name"></h4>
                                    <span :class="api.status === 'running' ? 'text-green-400' : 'text-red-400'"
                                          class="text-xs">
                                        <i class="fas fa-circle mr-1"></i>
                                        <span x-text="api.status"></span>
                                    </span>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">URL:</span>
                                        <span class="font-mono text-xs" x-text="api.url"></span>
                                    </div>
                                    <div>
                                        <span class="text-gray-400">Endpoints:</span>
                                        <div class="mt-1 space-y-1">
                                            <template x-for="endpoint in api.endpoints" :key="endpoint">
                                                <div class="text-xs font-mono text-blue-400" x-text="endpoint"></div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Performance Tab -->
                <div x-show="activeTab === 'performance'" class="space-y-4">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h3 class="font-semibold mb-4 text-lg">
                                <i class="fas fa-tachometer-alt mr-2"></i>System Performance
                            </h3>
                            <canvas id="performanceChart"></canvas>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h3 class="font-semibold mb-4 text-lg">
                                <i class="fas fa-memory mr-2"></i>Resource Usage
                            </h3>
                            <div class="space-y-4">
                                <template x-for="resource in resources" :key="resource.name">
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm" x-text="resource.name"></span>
                                            <span class="text-sm" x-text="`${resource.value}%`"></span>
                                        </div>
                                        <div class="w-full bg-gray-800 rounded-full h-2">
                                            <div :class="resource.value > 80 ? 'bg-red-500' : resource.value > 60 ? 'bg-yellow-500' : 'bg-green-500'"
                                                 class="h-2 rounded-full transition-all duration-300"
                                                 :style="`width: ${resource.value}%`"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Knowledge System Tab -->
                <div x-show="activeTab === 'knowledge'" class="space-y-4">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-600 to-blue-800 rounded-lg p-4 text-white">
                            <div class="text-2xl font-bold" x-text="knowledge.files"></div>
                            <div class="text-sm opacity-80">Files Indexed</div>
                        </div>
                        <div class="bg-gradient-to-br from-green-600 to-green-800 rounded-lg p-4 text-white">
                            <div class="text-2xl font-bold" x-text="knowledge.functions"></div>
                            <div class="text-sm opacity-80">Functions</div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-600 to-purple-800 rounded-lg p-4 text-white">
                            <div class="text-2xl font-bold" x-text="knowledge.classes"></div>
                            <div class="text-sm opacity-80">Classes</div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-600 to-orange-800 rounded-lg p-4 text-white">
                            <div class="text-2xl font-bold" x-text="knowledge.decisions"></div>
                            <div class="text-sm opacity-80">Decisions Tracked</div>
                        </div>
                    </div>

                    <div class="bg-gray-700 rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-lg">
                            <i class="fas fa-brain mr-2"></i>Recent Learning Events
                        </h3>
                        <div class="space-y-2">
                            <template x-for="event in learningEvents" :key="event.id">
                                <div class="flex items-center justify-between p-2 bg-gray-800 rounded">
                                    <div>
                                        <span class="text-sm" x-text="event.description"></span>
                                        <span class="text-xs text-gray-400 ml-2" x-text="event.time"></span>
                                    </div>
                                    <span class="text-xs px-2 py-1 bg-blue-600 rounded" x-text="event.type"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function dashboard() {
            return {
                activeTab: 'overview',
                refreshing: false,
                lastUpdate: new Date().toLocaleTimeString(),

                // Top level metrics
                topMetrics: [
                    { name: 'projects', label: 'Total Projects', value: '18', detail: 'Active repositories', icon: 'fas fa-project-diagram' },
                    { name: 'agents', label: 'AI Agents', value: '42', detail: 'Specialized agents', icon: 'fas fa-robot' },
                    { name: 'apis', label: 'Active APIs', value: '15', detail: 'Running services', icon: 'fas fa-server' },
                    { name: 'configs', label: 'CC Configs', value: '82', detail: 'Optimizations active', icon: 'fas fa-cog' },
                    { name: 'hooks', label: 'Active Hooks', value: '24', detail: 'Automation hooks', icon: 'fas fa-plug' },
                    { name: 'performance', label: 'Speed Boost', value: '4.3MÃ—', detail: 'Performance gain', icon: 'fas fa-rocket' }
                ],

                // Tab definitions
                tabs: [
                    { id: 'overview', name: 'System Overview', icon: 'fas fa-th-large', count: null },
                    { id: 'projects', name: 'Projects & Packages', icon: 'fas fa-folder-tree', count: '18' },
                    { id: 'agents', name: 'AI Agents', icon: 'fas fa-robot', count: '42' },
                    { id: 'configs', name: 'CC Configs', icon: 'fas fa-sliders-h', count: '82' },
                    { id: 'rules', name: 'Rules & Hooks', icon: 'fas fa-gavel', count: '35' },
                    { id: 'apis', name: 'APIs & Services', icon: 'fas fa-plug', count: '15' },
                    { id: 'performance', name: 'Performance', icon: 'fas fa-chart-line', count: null },
                    { id: 'knowledge', name: 'Knowledge System', icon: 'fas fa-brain', count: null }
                ],

                // Systems overview
                systems: [],
                projectTree: [],
                agents: [],
                ccConfigs: [],
                rules: [],
                hooks: [],
                apis: [],
                resources: [],
                knowledge: {
                    files: '9,017',
                    functions: '5,025',
                    classes: '704',
                    decisions: '1,234'
                },
                learningEvents: [],

                async init() {
                    await this.loadAllData();
                    this.initCharts();
                    setInterval(() => this.updateLiveData(), 5000);
                },

                async loadAllData() {
                    try {
                        // Fetch all data from the unified backend API (now on port 3000)
                        const response = await fetch('http://localhost:3000/api/dashboard');
                        const data = await response.json();

                        // Map the data to component state
                        this.systems = data.systems || await this.fetchSystems();
                        this.projectTree = data.projects || await this.fetchProjectTree();
                        this.agents = data.agents || await this.fetchAgents();

                        // Process configs
                        if (data.configs) {
                            this.ccConfigs = this.processConfigs(data.configs);
                            this.rules = data.configs.rules || await this.fetchRules();
                        } else {
                            this.ccConfigs = await this.fetchConfigs();
                            this.rules = await this.fetchRules();
                        }

                        this.hooks = data.hooks || await this.fetchHooks();
                        this.apis = this.processAPIs(data.systems) || await this.fetchAPIs();

                        // Process performance data
                        if (data.performance) {
                            this.resources = [
                                { name: 'CPU Usage', value: data.performance.cpu || 45 },
                                { name: 'Memory', value: data.performance.memory || 62 },
                                { name: 'Disk I/O', value: data.performance.disk || 28 },
                                { name: 'Network', value: data.performance.network || 15 },
                                { name: 'CC Instances', value: data.performance.ccInstances || 35 }
                            ];
                        } else {
                            this.resources = await this.fetchResources();
                        }

                        // Process knowledge stats
                        if (data.knowledge) {
                            this.knowledge = {
                                files: data.knowledge.files || '9,017',
                                functions: data.knowledge.functions || '5,025',
                                classes: data.knowledge.classes || '704',
                                decisions: data.knowledge.decisions || '1,234'
                            };
                        }

                        this.learningEvents = await this.fetchLearningEvents();

                        // Update top metrics based on real data
                        this.updateTopMetrics(data);

                    } catch (error) {
                        console.error('Failed to fetch dashboard data:', error);
                        // Fallback to mock data
                        await this.loadMockData();
                    }
                },

                async loadMockData() {
                    // Original mock data loading
                    this.systems = await this.fetchSystems();
                    this.projectTree = await this.fetchProjectTree();
                    this.agents = await this.fetchAgents();
                    this.ccConfigs = await this.fetchConfigs();
                    this.rules = await this.fetchRules();
                    this.hooks = await this.fetchHooks();
                    this.apis = await this.fetchAPIs();
                    this.resources = await this.fetchResources();
                    this.learningEvents = await this.fetchLearningEvents();
                },

                processConfigs(configs) {
                    const categories = [];
                    if (configs.environment) {
                        const envGroups = {
                            'Parallel Execution': [],
                            'CKS Integration': [],
                            'Auto-Commit': [],
                            'Learning System': []
                        };

                        configs.environment.forEach(env => {
                            const item = { name: env.name, value: env.value, enabled: env.value !== 'false' };
                            if (env.name.includes('PARALLEL') || env.name.includes('CCO')) {
                                envGroups['Parallel Execution'].push(item);
                            } else if (env.name.includes('CKS')) {
                                envGroups['CKS Integration'].push(item);
                            } else if (env.name.includes('COMMIT')) {
                                envGroups['Auto-Commit'].push(item);
                            } else if (env.name.includes('LEARNING')) {
                                envGroups['Learning System'].push(item);
                            }
                        });

                        for (const [category, items] of Object.entries(envGroups)) {
                            if (items.length > 0) {
                                categories.push({ category, items });
                            }
                        }
                    }
                    return categories.length > 0 ? categories : this.fetchConfigs();
                },

                processAPIs(systems) {
                    if (!systems) return null;
                    return systems.filter(s => s.type === 'API').map(s => ({
                        name: s.name,
                        status: s.status === 'active' ? 'running' : 'stopped',
                        url: s.url || `http://localhost:${s.port}`,
                        endpoints: this.getAPIEndpoints(s.name)
                    }));
                },

                getAPIEndpoints(name) {
                    const endpoints = {
                        'CKS': ['/search/function', '/check/duplicate', '/stats'],
                        'ENHANCEMENT': ['/api/status', '/api/{system}/{method}'],
                        'LEARNING': ['/capture', '/analyze', '/patterns'],
                        'CCO': ['/status', '/enhance', '/execute']
                    };
                    return endpoints[name] || [];
                },

                updateTopMetrics(data) {
                    if (!data) return;

                    this.topMetrics[0].value = data.projects ? data.projects.length.toString() : '18';
                    this.topMetrics[1].value = data.agents ? data.agents.length.toString() : '42';
                    this.topMetrics[2].value = data.systems ? data.systems.filter(s => s.status === 'active').length.toString() : '15';
                    this.topMetrics[3].value = data.configs && data.configs.enhancements ? data.configs.enhancements.toString() : '82';
                    this.topMetrics[4].value = data.hooks ? data.hooks.length.toString() : '24';
                },

                async fetchSystems() {
                    // This would fetch from actual APIs
                    return [
                        { name: 'CKS (Knowledge System)', status: 'active', port: '5555', type: 'API', path: '/caia/knowledge-system' },
                        { name: 'Enhancement System', status: 'active', port: '5002', type: 'API', path: '/caia/cc-enhancement' },
                        { name: 'Learning System', status: 'active', port: '5003', type: 'API', path: '/caia/learning-system' },
                        { name: 'CAIA Dashboard', status: 'active', port: '3456', type: 'Web', path: '/caia/dashboard' },
                        { name: 'CC Orchestrator', status: 'active', port: '8885', type: 'Daemon', path: '/caia/cc-orchestrator' },
                        { name: 'Knowledge Explorer', status: 'active', port: '5000', type: 'Web', path: '/caia/knowledge_explorer_ui' }
                    ];
                },

                async fetchProjectTree() {
                    return [
                        {
                            name: 'caia',
                            path: '/caia',
                            items: 156,
                            expanded: false,
                            children: [
                                { name: 'packages', icon: 'fas fa-box' },
                                { name: 'tools', icon: 'fas fa-wrench' },
                                { name: 'knowledge-system', icon: 'fas fa-brain' },
                                { name: 'cc-orchestrator', icon: 'fas fa-network-wired' },
                                { name: 'dashboard', icon: 'fas fa-chart-pie' }
                            ]
                        },
                        {
                            name: 'claude-code-ultimate',
                            path: '/claude-code-ultimate',
                            items: 82,
                            expanded: false,
                            children: [
                                { name: 'configs', icon: 'fas fa-cog' },
                                { name: 'parallel_tasks', icon: 'fas fa-tasks' },
                                { name: 'monitor_dashboard.py', icon: 'fas fa-python' }
                            ]
                        }
                    ];
                },

                async fetchAgents() {
                    return [
                        { name: 'frontend-developer', icon: 'fas fa-code', description: 'UI/UX development', active: true, tools: ['Write', 'Read', 'MultiEdit'] },
                        { name: 'backend-architect', icon: 'fas fa-server', description: 'API and server design', active: true, tools: ['Write', 'Read', 'Bash'] },
                        { name: 'devops-automator', icon: 'fas fa-infinity', description: 'CI/CD automation', active: true, tools: ['Bash', 'Write', 'Grep'] },
                        { name: 'whimsy-injector', icon: 'fas fa-magic', description: 'Add delightful touches', active: true, tools: ['Write', 'MultiEdit'] },
                        { name: 'sprint-prioritizer', icon: 'fas fa-list-ol', description: '6-day sprint planning', active: false, tools: ['Write', 'TodoWrite'] },
                        { name: 'test-writer-fixer', icon: 'fas fa-vial', description: 'Test automation', active: true, tools: ['*'] },
                        { name: 'rapid-prototyper', icon: 'fas fa-rocket', description: 'Quick MVP creation', active: true, tools: ['Write', 'Task'] },
                        { name: 'ai-engineer', icon: 'fas fa-brain', description: 'ML/AI integration', active: false, tools: ['Write', 'WebFetch'] }
                    ];
                },

                async fetchConfigs() {
                    return [
                        {
                            category: 'Parallel Execution',
                            items: [
                                { name: 'MAX_PARALLEL', value: '50', enabled: true },
                                { name: 'CCO_AUTO_INVOKE', value: 'true', enabled: true },
                                { name: 'PARALLEL_JOBS', value: '50', enabled: true },
                                { name: 'TURBO_MODE', value: 'false', enabled: false }
                            ]
                        },
                        {
                            category: 'CKS Integration',
                            items: [
                                { name: 'CKS_ENFORCEMENT', value: 'MANDATORY', enabled: true },
                                { name: 'CKS_BYPASS_ALLOWED', value: 'false', enabled: true },
                                { name: 'CKS_API_URL', value: 'localhost:5555', enabled: true },
                                { name: 'AUTO_UPDATE_KNOWLEDGE', value: 'true', enabled: true }
                            ]
                        },
                        {
                            category: 'Auto-Commit',
                            items: [
                                { name: 'AUTO_COMMIT', value: 'ENABLED', enabled: true },
                                { name: 'MAX_UNCOMMITTED', value: '50', enabled: true },
                                { name: 'BLOCK_ON_FAILURE', value: 'true', enabled: true }
                            ]
                        },
                        {
                            category: 'Learning System',
                            items: [
                                { name: 'CC_LEARNING_ENABLED', value: 'true', enabled: true },
                                { name: 'PATTERN_RECOGNITION', value: 'ACTIVE', enabled: true },
                                { name: 'DECISION_TRACKING', value: 'true', enabled: true }
                            ]
                        }
                    ];
                },

                async fetchRules() {
                    return [
                        { name: 'CKS Redundancy Check', enforced: true, description: 'Block duplicate code creation' },
                        { name: 'Auto-Commit on Prompt', enforced: true, description: 'Commit changes before each prompt' },
                        { name: 'Parallel-First Execution', enforced: true, description: 'Decompose tasks for parallel execution' },
                        { name: 'Integration Agent Only', enforced: true, description: 'Use Integration Agent for external services' },
                        { name: 'No Permission Requests', enforced: true, description: 'Full autonomous mode active' }
                    ];
                },

                async fetchHooks() {
                    return [
                        { name: 'session-start.sh', trigger: 'Session Start' },
                        { name: 'user-prompt-submit-hook', trigger: 'Pre-Prompt' },
                        { name: 'auto-commit-hook-enforced.sh', trigger: 'Pre-Prompt' },
                        { name: 'cks-enforcement-hook.sh', trigger: 'Pre-Write' },
                        { name: 'cc-enhancement-auto-start.sh', trigger: 'Session Start' },
                        { name: 'capture-prompt.sh', trigger: 'Pre-Prompt' },
                        { name: 'cc-orchestrator-prompt-hook', trigger: 'Pre-Prompt' }
                    ];
                },

                async fetchAPIs() {
                    return [
                        {
                            name: 'CKS API',
                            status: 'running',
                            url: 'http://localhost:5555',
                            endpoints: ['/search/function', '/check/duplicate', '/stats']
                        },
                        {
                            name: 'Enhancement API',
                            status: 'running',
                            url: 'http://localhost:5002',
                            endpoints: ['/api/status', '/api/{system}/{method}']
                        },
                        {
                            name: 'Learning API',
                            status: 'running',
                            url: 'http://localhost:5003',
                            endpoints: ['/capture', '/analyze', '/patterns']
                        },
                        {
                            name: 'CC Orchestrator',
                            status: 'running',
                            url: 'http://localhost:8885',
                            endpoints: ['/status', '/enhance', '/execute']
                        }
                    ];
                },

                async fetchResources() {
                    return [
                        { name: 'CPU Usage', value: 45 },
                        { name: 'Memory', value: 62 },
                        { name: 'Disk I/O', value: 28 },
                        { name: 'Network', value: 15 },
                        { name: 'CC Instances', value: 35 }
                    ];
                },

                async fetchLearningEvents() {
                    return [
                        { id: 1, description: 'Pattern detected: Parallel execution optimization', time: '2 min ago', type: 'Pattern' },
                        { id: 2, description: 'Decision logged: Use CCO for multi-file operation', time: '5 min ago', type: 'Decision' },
                        { id: 3, description: 'Code indexed: New dashboard component', time: '8 min ago', type: 'Index' },
                        { id: 4, description: 'Prompt captured: User requested atomic dashboard', time: '10 min ago', type: 'Capture' },
                        { id: 5, description: 'Learning: Dashboard implementation pattern', time: '12 min ago', type: 'Learning' }
                    ];
                },

                async refreshAll() {
                    this.refreshing = true;
                    await this.loadAllData();
                    this.lastUpdate = new Date().toLocaleTimeString();
                    setTimeout(() => { this.refreshing = false; }, 1000);
                },

                async updateLiveData() {
                    // Update live metrics
                    this.resources.forEach(r => {
                        r.value = Math.min(100, Math.max(0, r.value + (Math.random() - 0.5) * 10));
                    });
                    this.lastUpdate = new Date().toLocaleTimeString();
                },

                initCharts() {
                    // Package distribution chart
                    const packageCtx = document.getElementById('packageChart');
                    if (packageCtx) {
                        new Chart(packageCtx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Agents', 'Tools', 'Services', 'Utils', 'Configs'],
                                datasets: [{
                                    data: [42, 28, 15, 35, 82],
                                    backgroundColor: [
                                        '#3B82F6', '#10B981', '#F59E0B', '#8B5CF6', '#EF4444'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        labels: { color: '#E5E7EB' }
                                    }
                                }
                            }
                        });
                    }

                    // Performance chart
                    const perfCtx = document.getElementById('performanceChart');
                    if (perfCtx) {
                        new Chart(perfCtx, {
                            type: 'line',
                            data: {
                                labels: ['1h ago', '45m', '30m', '15m', 'Now'],
                                datasets: [{
                                    label: 'Response Time (ms)',
                                    data: [120, 95, 88, 92, 85],
                                    borderColor: '#3B82F6',
                                    tension: 0.4
                                }, {
                                    label: 'API Calls/min',
                                    data: [45, 52, 48, 58, 62],
                                    borderColor: '#10B981',
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: {
                                        grid: { color: '#374151' },
                                        ticks: { color: '#E5E7EB' }
                                    },
                                    x: {
                                        grid: { color: '#374151' },
                                        ticks: { color: '#E5E7EB' }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: { color: '#E5E7EB' }
                                    }
                                }
                            }
                        });
                    }
                }
            }
        }
    </script>
</body>
</html>